# Aion
Aion is a library that wraps the use of the setInterval() and setTimeout()
functions in Javascript in an attempt to make them both more flexible and easier
to understand. If not otherwise specified the default unit of time in the Aion
library is assumed to be a second. Note, given the nature of timers within the
context of a browser, durations and intervals are not exact and you should not
use them with the expectation that they are.

## Incorporating The Library
The Aion library has no dependencies on any other libraries so using it is
simply a matter of incorporating it on to your web page. The following is an
example of how this might be achieved in HTML...

```
   <script type="text/javascript" src="javascripts/aion-2.0.0.min.js"></script>
```

Note that this incorporates the minimized version of the script. A non-minimized
version is also available for debugging purposes.

## Using The Library
There are two usage scenarios handled within the Aion library. These are...

* There is a piece of functionality that must be executable after a minimum
  amount of time.
* There is a piece of functionality that must be executed as regular intervals.

The first of these correlates with the use of setTimeout() and the second with
the use of setInterval(). Aion goes beyond these basic scenarios a little by
allowing you to incorporate elements that get fire in relation to the timers
(e.g. before they start or after they complete). In the case of Interval the
library also allows you to specify a maximum duration. Finally the library takes
care of cleaning up timers and intervals automatically where possible or via
the facilities provided for manual intervention (i.e. cancellation).

### Duration Example
The following code gives a basic example of using Aion to execute a piece of
code after a specified period of time...

```
   function showGreeting() {
      alert("Hello World!");
   }
   Aion.in(5, "seconds").do(showGreeting).start();
```

The first three lines in this example are a function that we will invoke after
a 5 second wait. The last line is where we interact with Aion to get this to
happen. This line is actually made up of three separate function calls that are
chained together and this is a common approach for using the library as it
allows your intention to be read from left to right.

The first function call in the chain is to a function call in(). This informs
Aion that you want to execute a piece of functionality once after a specific
duration. The duration is specified as parameters to the in() function, in our
case we send two parameters - 5 and "seconds". Five is the length of the duration
we want to wait and "seconds" is the unit. The unit here is optional and defaults
to "seconds" if not specified. Other possible values include "minutes", "hours"
and "days".

The call to the in() function returns an object representing the duration that
we've specified. This object also provides other facilities such as a function
to cancel the duration if we'd like to do that. This object can be stored in a
local variable or passed around as needed. The second function we call is on this
duration object and is called do(). This function takes a single parameter that
should be the function that you want to execute at the expiry of the duration.

The final function we call is also sent to the duration object (the do() function
returns this object allowing calls to be chained in this fashion). The last call
is to a function called start(). When we create a duration it is not immediately
kicked off and we must explicitly do this by calling the start() function.

### Interval Example
The following code gives a basic example of using Aion to execute a piece of
code at regular intervals (or as regular as the browser allows for)...

```
   function formatDuration(duration) {
      var seconds = Math.round(duration / 1000),
          pieces  = [];

      if(seconds >= 86400) {
         pieces.push(Math.floor(seconds / 86400));
      }
      pieces.push(Math.floor((seconds % 86400) / 3600));
      pieces.push(Math.floor((seconds % 3600) / 60));
      pieces.push(seconds % 60);

      for(var i = 0; i < pieces.length; i++) {
         pieces[i] = "" + (pieces[i] < 10 ? "0" + pieces[i] : pieces[i]);
      }

      return(pieces.join(":"));
   }

   function updateTimer(interval) {
      var element = document.getElementById("timer");

      element.innerHTML = formatDuration(interval.expended());
   }

   Aion.every(1, "second").do(updateTimer).start();
```

In this example we first declare two functions. The first is responsible for
formatting a value in milliseconds into a string for display. The second is
responsible for adding the string generated by the first as the content for an
element on the document. Once again the final line is where we interact with the
Aion library.

In this final line we first make a call to the every() function. This informs
Aion that you are creating an interval (i.e. a piece of functionality that will
get executed repeatedly). The parameters passed to this call indicate that our
functionality will be invoked once a second (approximately). As with calls to
the in() function, a call to every() returns an object we can use to interact
with the interval we're creating. We next call the do() function on the interval
object we've created. This specifies what gets done by the interval. Finally we
call the start method to kick the interval off.

Like a duration, intervals can be cancelled by calling the cancel() function on
the interval method. Intervals are more complicated than durations and therefore
offer more options. For example, we might decide that we want an interval that
runs every second for 1 minute. To do that we can use something like the
following...

```
   Aion.every(1, "second").for(1, "minute").do(updateTimer).start();
```

This would execute the updateTimer function once a second for 1 minute and then
stop. We can add to this again by specifying a separate action that gets called
when the interval stops using something like this...

```
   Aion.every(1, "second").for(1, "minute").do(updateTimer).then(clearTimer).start();
```

This would work as before but, after the interval has run for a minute and has
come to a stop we would also invoked the clearTimer function once.
